{"version":3,"sources":["views/NewPassword.tsx"],"names":["NewPasswordSchema","Yup","shape","password","required","confirmPassword","test","value","this","parent","withRouter","props","appStyles","useAppStyles","useLoader","startLoading","stopLoading","React","useState","token","setToken","dispatch","useContext","AuthContext","useEffect","search","location","url_token","URLSearchParams","get","history","push","onSubmit","a","gatoAPI","sendNewPassword","accessToken","data","type","status","error","className","authCardContainer","container","style","marginTop","variant","titleDisplay","initialValues","validationSchema","values","handleChange","handleBlur","handleSubmit","errors","touched","id","label","onChange","onBlur","autoComplete","undefined","errorMessage","handleError","color"],"mappings":"uQAmBMA,EAAoBC,MAAaC,MAAM,CAC3CC,SAAUF,MAAaG,SAAS,2BAChCC,gBAAiBJ,MACdG,SAAS,2BACTE,KAAK,kBAAmB,mCAAgC,SAASC,GAChE,OAAOC,KAAKC,OAAON,WAAaI,OAwGvBG,uBApGK,SAACC,GACnB,IAAMC,EAAYC,cADgC,EAEZC,cAA9BC,EAF0C,EAE1CA,aAAcC,EAF4B,EAE5BA,YAF4B,EAGxBC,IAAMC,SAAS,IAHS,mBAG3CC,EAH2C,KAGpCC,EAHoC,KAK1CC,EAAaJ,IAAMK,WAAWC,KAA9BF,SAERJ,IAAMO,WAAU,WACd,IAAMC,EAASd,EAAMe,SAASD,OAExBE,EADS,IAAIC,gBAAgBH,GACVI,IAAI,SACX,KAAdF,GAAkC,OAAdA,EACtBhB,EAAMmB,QAAQC,KAAK,UAEnBX,EAASO,KAEV,CAACP,EAAUT,EAAMmB,QAASnB,EAAMe,SAASD,SAE5C,IAKMO,EAAQ,uCAAG,iCAAAC,EAAA,6DAAS9B,EAAT,EAASA,SACxBY,IADe,kBAKHmB,IAAQC,gBAAgB,CAChChC,WACAgB,UAPW,gBAIHiB,EAJG,EAIXC,KAAQD,YAKVf,EAAS,CAAEiB,KAAM,QAASF,gBAC1BpB,IAVa,uDAWJuB,OAXI,KAWIC,MACjBxB,IAZa,0DAAH,sDAmBd,OACE,yBAAKyB,UAAW7B,EAAU8B,mBACxB,kBAAC,IAAD,CAAMC,WAAS,EAACC,MAAO,CAAEC,UAAW,KAClC,kBAAC,IAAD,CAAYC,QAAQ,KAAKL,UAAW7B,EAAUmC,cAA9C,8BAIF,kBAAC,IAAD,CAAMJ,WAAS,EAACC,MAAO,CAAEC,UAAW,MACpC,kBAAC,IAAD,CACEG,cAjC4B,CAChC7C,SAAU,GACVE,gBAAiB,IAgCb2B,SAAUA,EACViB,iBAAkBjD,IAEjB,gBACCkD,EADD,EACCA,OACAC,EAFD,EAECA,aACAC,EAHD,EAGCA,WACAC,EAJD,EAICA,aACAC,EALD,EAKCA,OACAC,EAND,EAMCA,QAND,OAQC,0BAAMvB,SAAUqB,GACd,kBAAC,IAAD,CACEG,GAAG,WACHC,MAAM,sBACNnB,KAAK,WACL/B,MAAO2C,EAAO/C,SACduD,SAAUP,EACVQ,OAAQP,EACRQ,aAAa,eACbpB,WAA2BqB,IAApBP,EAAOnD,UAA0BoD,EAAQpD,SAChD2D,aAAcR,EAAOnD,SACrB4D,aAAW,IAGb,kBAAC,IAAD,CACEP,GAAG,kBACHC,MAAM,8BACNnB,KAAK,WACL/B,MAAO2C,EAAO7C,gBACdqD,SAAUP,EACVQ,OAAQP,EACRQ,aAAa,eACbpB,WAC6BqB,IAA3BP,EAAOjD,iBAAiCkD,EAAQlD,gBAElDyD,aAAcR,EAAOjD,gBACrB0D,aAAW,IAGb,kBAAC,IAAD,CAAQC,MAAM,UAAU1B,KAAK,SAASmB,MAAM","file":"static/js/NewPassword.a161a00e.chunk.js","sourcesContent":["import React from 'react'\n\nimport { Grid, Typography } from '@material-ui/core'\n\nimport { withRouter, RouteComponentProps } from 'react-router'\n\nimport { Button, TextField, useAppStyles } from '@elgatoylacaja/components'\nimport { Formik } from 'formik'\n\nimport * as Yup from 'yup'\nimport { useLoader } from '@elgatoylacaja/hooks'\nimport { gatoAPI } from '@elgatoylacaja/utils'\nimport { AuthContext } from '../contexts/AuthContext'\n\ninterface FormValues {\n  password: string\n  confirmPassword: string\n}\n\nconst NewPasswordSchema = Yup.object().shape({\n  password: Yup.string().required('Este campo es requerido'),\n  confirmPassword: Yup.string()\n    .required('Este campo es requerido')\n    .test('passwords-match', 'Las contraseñas no coinciden', function(value) {\n      return this.parent.password === value\n    }),\n})\n\nconst NewPassword = (props: RouteComponentProps) => {\n  const appStyles = useAppStyles()\n  const { startLoading, stopLoading } = useLoader()\n  const [token, setToken] = React.useState('')\n\n  const { dispatch } = React.useContext(AuthContext)\n\n  React.useEffect(() => {\n    const search = props.location.search\n    const params = new URLSearchParams(search)\n    const url_token = params.get('token')\n    if (url_token === '' || url_token === null) {\n      props.history.push('/login')\n    } else {\n      setToken(url_token)\n    }\n  }, [setToken, props.history, props.location.search])\n\n  const initialValues: FormValues = {\n    password: '',\n    confirmPassword: '',\n  }\n\n  const onSubmit = async ({ password }: FormValues) => {\n    startLoading()\n    try {\n      const {\n        data: { accessToken },\n      } = await gatoAPI.sendNewPassword({\n        password,\n        token,\n      })\n      dispatch({ type: 'LOGIN', accessToken })\n      stopLoading()\n    } catch ({ status, error }) {\n      stopLoading()\n      if (status === 403) {\n        // hubo un error con el token\n      }\n    }\n  }\n\n  return (\n    <div className={appStyles.authCardContainer}>\n      <Grid container style={{ marginTop: 10 }}>\n        <Typography variant=\"h1\" className={appStyles.titleDisplay}>\n          Crear nueva contraseña\n        </Typography>\n      </Grid>\n      <Grid container style={{ marginTop: 10 }} />\n      <Formik\n        initialValues={initialValues}\n        onSubmit={onSubmit}\n        validationSchema={NewPasswordSchema}\n      >\n        {({\n          values,\n          handleChange,\n          handleBlur,\n          handleSubmit,\n          errors,\n          touched,\n        }) => (\n          <form onSubmit={handleSubmit}>\n            <TextField\n              id=\"password\"\n              label=\"Nueva contraseña\"\n              type=\"password\"\n              value={values.password}\n              onChange={handleChange}\n              onBlur={handleBlur}\n              autoComplete=\"new-password\"\n              error={errors.password !== undefined && touched.password}\n              errorMessage={errors.password}\n              handleError\n            />\n\n            <TextField\n              id=\"confirmPassword\"\n              label=\"Repetir nueva contraseña\"\n              type=\"password\"\n              value={values.confirmPassword}\n              onChange={handleChange}\n              onBlur={handleBlur}\n              autoComplete=\"new-password\"\n              error={\n                errors.confirmPassword !== undefined && touched.confirmPassword\n              }\n              errorMessage={errors.confirmPassword}\n              handleError\n            />\n\n            <Button color=\"primary\" type=\"submit\" label=\"Crear contraseña\" />\n          </form>\n        )}\n      </Formik>\n    </div>\n  )\n}\n\nexport default withRouter(NewPassword)\n"],"sourceRoot":""}